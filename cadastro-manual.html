<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro Manual - Aqui aceita Bitcoin?</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/bitcoin-maps.css">
    <style>
        .cadastro-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        input[type="text"], 
        input[type="email"],
        input[type="tel"],
        input[type="url"],
        textarea,
        select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        
        textarea {
            height: 100px;
            resize: vertical;
        }
        
        .checkbox-group {
            display: flex;
            gap: 20px;
            margin-top: 10px;
        }
        
        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .coordinates {
            display: flex;
            gap: 10px;
        }
        
        .coordinates input {
            flex: 1;
        }
        
        button[type="submit"], .btn-primary {
            background-color: #f7931a;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        
        button[type="submit"]:hover, .btn-primary:hover {
            background-color: #e78008;
        }
        
        .success-message {
            background-color: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
            display: none;
        }
        
        .error-message {
            background-color: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
            display: none;
        }
        
        .info-message {
            background-color: #cce5ff;
            color: #004085;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
        }
        
        .establishment-list {
            margin-top: 30px;
            border-collapse: collapse;
            width: 100%;
        }
        
        .establishment-list th, 
        .establishment-list td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        .establishment-list th {
            background-color: #f2f2f2;
            font-weight: bold;
        }
        
        .establishment-list tr:hover {
            background-color: #f5f5f5;
        }
        
        .status-flag {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 5px;
        }
        
        .status-pending {
            background-color: #dc3545; /* Vermelho */
        }
        
        .status-synced {
            background-color: #fd7e14; /* Laranja */
        }
        
        .status-verified {
            background-color: #28a745; /* Verde */
        }
        
        .tab-container {
            margin-bottom: 20px;
        }
        
        .tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
        }
        
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            background-color: #f8f9fa;
            border: 1px solid #ddd;
            border-bottom: none;
            border-radius: 4px 4px 0 0;
            margin-right: 5px;
        }
        
        .tab.active {
            background-color: white;
            border-bottom: 1px solid white;
            margin-bottom: -1px;
            font-weight: bold;
        }
        
        .tab-content {
            display: none;
            padding: 20px;
            border: 1px solid #ddd;
            border-top: none;
            border-radius: 0 0 4px 4px;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .btn-action {
            padding: 5px 10px;
            margin-right: 5px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            border: none;
        }
        
        .btn-edit {
            background-color: #ffc107;
            color: #212529;
        }
        
        .btn-sync {
            background-color: #17a2b8;
            color: white;
        }
        
        .btn-delete {
            background-color: #dc3545;
            color: white;
        }
    </style>
</head>
<body>
    <header>
        <div class="logo">
            <a href="index.html">
                <img src="assets/images/bitcoin-logo.svg" alt="Logo Bitcoin">
                <h1>Aqui aceita Bitcoin?</h1>
            </a>
        </div>
        <nav>
            <ul class="main-nav">
                <li><a href="index.html#bitcoin-maps">Bitcoin Maps</a></li>
                <li><a href="index.html#sobre">Sobre o Projeto</a></li>
                <li><a href="index.html#estabelecimentos">Estabelecimentos</a></li>
                <li><a href="index.html#carteiras">Carteiras</a></li>
                <li><a href="cadastro-manual.html" class="active">Cadastro Manual</a></li>
                <li><a href="admin.html">Administração</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <div class="cadastro-container">
            <h2>Cadastro Manual de Estabelecimentos</h2>
            
            <div class="success-message" id="success-message">
                Estabelecimento cadastrado com sucesso! O ponto será adicionado ao mapa após revisão.
            </div>
            
            <div class="error-message" id="error-message">
                Erro ao cadastrar estabelecimento. Por favor, tente novamente.
            </div>
            
            <div class="tab-container">
                <div class="tabs">
                    <div class="tab active" data-tab="cadastro">Cadastrar Estabelecimento</div>
                    <div class="tab" data-tab="lista">Lista de Estabelecimentos</div>
                </div>
                
                <div class="tab-content active" id="cadastro-tab">
                    <div class="info-message">
                        <strong>Sistema de Cadastro Manual</strong>
                        <p>Este formulário permite cadastrar manualmente estabelecimentos que aceitam Bitcoin. Após o cadastro, o estabelecimento ficará com status "Pendente" (vermelho) até que seja sincronizado com o BTC Maps.</p>
                        <p>Após a sincronização manual com o BTC Maps, o status mudará para "Sincronizado" (laranja).</p>
                    </div>
                    
                    <form id="cadastro-form">
                        <div class="form-group">
                            <label for="nome">Nome do Estabelecimento *</label>
                            <input type="text" id="nome" name="nome" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="categoria">Categoria *</label>
                            <select id="categoria" name="categoria" required>
                                <option value="">Selecione uma categoria</option>
                                <option value="Restaurante">Restaurante</option>
                                <option value="Café">Café</option>
                                <option value="Bar">Bar</option>
                                <option value="Loja">Loja</option>
                                <option value="Hotel">Hotel</option>
                                <option value="Serviço">Serviço</option>
                                <option value="Outro">Outro</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="endereco">Endereço Completo *</label>
                            <input type="text" id="endereco" name="endereco" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="cidade">Cidade *</label>
                            <input type="text" id="cidade" name="cidade" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="estado">Estado *</label>
                            <input type="text" id="estado" name="estado" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="coordenadas">Coordenadas (Latitude, Longitude)</label>
                            <div class="coordinates">
                                <input type="text" id="latitude" name="latitude" placeholder="Latitude (ex: -25.123456)">
                                <input type="text" id="longitude" name="longitude" placeholder="Longitude (ex: -50.123456)">
                            </div>
                            <small>Você pode obter as coordenadas no Google Maps clicando com o botão direito no local e selecionando "O que há aqui?"</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="telefone">Telefone</label>
                            <input type="tel" id="telefone" name="telefone">
                        </div>
                        
                        <div class="form-group">
                            <label for="website">Website</label>
                            <input type="url" id="website" name="website" placeholder="https://...">
                        </div>
                        
                        <div class="form-group">
                            <label for="descricao">Descrição</label>
                            <textarea id="descricao" name="descricao"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label>Métodos de Pagamento Bitcoin Aceitos</label>
                            <div class="checkbox-group">
                                <div class="checkbox-item">
                                    <input type="checkbox" id="lightning" name="lightning" checked>
                                    <label for="lightning">Lightning Network</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="onchain" name="onchain" checked>
                                    <label for="onchain">On-chain (Bitcoin)</label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="osm_id">ID no OpenStreetMap (opcional)</label>
                            <input type="text" id="osm_id" name="osm_id" placeholder="Ex: node/123456789">
                            <small>Se o estabelecimento já existe no OpenStreetMap, informe o ID</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="contato_nome">Seu Nome *</label>
                            <input type="text" id="contato_nome" name="contato_nome" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="contato_email">Seu Email *</label>
                            <input type="email" id="contato_email" name="contato_email" required>
                        </div>
                        
                        <button type="submit">Cadastrar Estabelecimento</button>
                    </form>
                </div>
                
                <div class="tab-content" id="lista-tab">
                    <div class="info-message">
                        <strong>Lista de Estabelecimentos Cadastrados</strong>
                        <p>Abaixo estão todos os estabelecimentos cadastrados no sistema. Os status são indicados por cores:</p>
                        <p>
                            <span class="status-flag status-pending"></span> <strong>Vermelho:</strong> Pendente (aguardando sincronização com BTC Maps)<br>
                            <span class="status-flag status-synced"></span> <strong>Laranja:</strong> Sincronizado com BTC Maps<br>
                            <span class="status-flag status-verified"></span> <strong>Verde:</strong> Verificado (confirmado pessoalmente)
                        </p>
                    </div>
                    
                    <table class="establishment-list" id="establishment-table">
                        <thead>
                            <tr>
                                <th>Status</th>
                                <th>Nome</th>
                                <th>Categoria</th>
                                <th>Cidade</th>
                                <th>Data de Cadastro</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="establishment-list">
                            <!-- Preenchido via JavaScript -->
                        </tbody>
                    </table>
                    
                    <div id="no-establishments" style="display: none; text-align: center; padding: 20px;">
                        <p>Nenhum estabelecimento cadastrado ainda.</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer>
        <p>&copy; 2025 Aqui aceita Bitcoin? - Todos os direitos reservados</p>
    </footer>

    <script>
        // Gerenciamento de abas
        document.addEventListener('DOMContentLoaded', function() {
            const tabs = document.querySelectorAll('.tab');
            const tabContents = document.querySelectorAll('.tab-content');
            
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    
                    // Remover classe active de todas as abas
                    tabs.forEach(t => t.classList.remove('active'));
                    tabContents.forEach(c => c.classList.remove('active'));
                    
                    // Adicionar classe active na aba clicada
                    this.classList.add('active');
                    document.getElementById(`${tabId}-tab`).classList.add('active');
                    
                    // Se a aba for a lista, carregar os estabelecimentos
                    if (tabId === 'lista') {
                        loadEstablishments();
                    }
                });
            });
            
            // Inicializar o formulário
            const form = document.getElementById('cadastro-form');
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                saveEstablishment();
            });
            
            // Carregar estabelecimentos se a aba lista estiver ativa
            if (document.querySelector('.tab[data-tab="lista"]').classList.contains('active')) {
                loadEstablishments();
            }
        });
        
        // Função para salvar estabelecimento
        function saveEstablishment() {
            const form = document.getElementById('cadastro-form');
            const successMessage = document.getElementById('success-message');
            const errorMessage = document.getElementById('error-message');
            
            // Obter dados do formulário
            const establishment = {
                id: generateId(),
                nome: document.getElementById('nome').value,
                categoria: document.getElementById('categoria').value,
                endereco: document.getElementById('endereco').value,
                cidade: document.getElementById('cidade').value,
                estado: document.getElementById('estado').value,
                latitude: document.getElementById('latitude').value || null,
                longitude: document.getElementById('longitude').value || null,
                telefone: document.getElementById('telefone').value || null,
                website: document.getElementById('website').value || null,
                descricao: document.getElementById('descricao').value || null,
                lightning: document.getElementById('lightning').checked,
                onchain: document.getElementById('onchain').checked,
                osm_id: document.getElementById('osm_id').value || null,
                contato_nome: document.getElementById('contato_nome').value,
                contato_email: document.getElementById('contato_email').value,
                data_cadastro: new Date().toISOString(),
                status: 'pending', // Status inicial: pendente (vermelho)
                sincronizado: false
            };
            
            try {
                // Obter lista atual de estabelecimentos
                let establishments = JSON.parse(localStorage.getItem('establishments') || '[]');
                
                // Adicionar novo estabelecimento
                establishments.push(establishment);
                
                // Salvar no localStorage
                localStorage.setItem('establishments', JSON.stringify(establishments));
                
                // Mostrar mensagem de sucesso
                successMessage.style.display = 'block';
                errorMessage.style.display = 'none';
                
                // Limpar formulário
                form.reset();
                
                // Esconder mensagem após 5 segundos
                setTimeout(() => {
                    successMessage.style.display = 'none';
                }, 5000);
                
                // Registrar no log de auditoria
                logAction('Cadastro', `Estabelecimento "${establishment.nome}" cadastrado manualmente`);
                
                // Atualizar contadores
                updateCounters();
                
            } catch (error) {
                console.error('Erro ao salvar estabelecimento:', error);
                errorMessage.style.display = 'block';
                successMessage.style.display = 'none';
                
                // Esconder mensagem após 5 segundos
                setTimeout(() => {
                    errorMessage.style.display = 'none';
                }, 5000);
            }
        }
        
        // Função para carregar estabelecimentos
        function loadEstablishments() {
            const tableBody = document.getElementById('establishment-list');
            const noEstablishments = document.getElementById('no-establishments');
            
            // Obter lista de estabelecimentos
            const establishments = JSON.parse(localStorage.getItem('establishments') || '[]');
            
            // Limpar tabela
            tableBody.innerHTML = '';
            
            if (establishments.length === 0) {
                noEstablishments.style.display = 'block';
                return;
            }
            
            noEstablishments.style.display = 'none';
            
            // Ordenar por data de cadastro (mais recente primeiro)
            establishments.sort((a, b) => new Date(b.data_cadastro) - new Date(a.data_cadastro));
            
            // Preencher tabela
            establishments.forEach(establishment => {
                const row = document.createElement('tr');
                
                // Status com flag colorida
                const statusCell = document.createElement('td');
                const statusFlag = document.createElement('span');
                statusFlag.className = `status-flag status-${establishment.status}`;
                
                let statusText = '';
                switch(establishment.status) {
                    case 'pending':
                        statusText = 'Pendente';
                        break;
                    case 'synced':
                        statusText = 'Sincronizado';
                        break;
                    case 'verified':
                        statusText = 'Verificado';
                        break;
                }
                
                statusCell.appendChild(statusFlag);
                statusCell.appendChild(document.createTextNode(statusText));
                row.appendChild(statusCell);
                
                // Nome
                const nameCell = document.createElement('td');
                nameCell.textContent = establishment.nome;
                row.appendChild(nameCell);
                
                // Categoria
                const categoryCell = document.createElement('td');
                categoryCell.textContent = establishment.categoria;
                row.appendChild(categoryCell);
                
                // Cidade
                const cityCell = document.createElement('td');
                cityCell.textContent = establishment.cidade;
                row.appendChild(cityCell);
                
                // Data de cadastro
                const dateCell = document.createElement('td');
                dateCell.textContent = new Date(establishment.data_cadastro).toLocaleDateString();
                row.appendChild(dateCell);
                
                // Ações
                const actionsCell = document.createElement('td');
                
                // Botão Editar
                const editButton = document.createElement('button');
                editButton.className = 'btn-action btn-edit';
                editButton.textContent = 'Editar';
                editButton.onclick = () => editEstablishment(establishment.id);
                actionsCell.appendChild(editButton);
                
                // Botão Sincronizar (apenas se estiver pendente)
                if (establishment.status === 'pending') {
                    const syncButton = document.createElement('button');
                    syncButton.className = 'btn-action btn-sync';
                    syncButton.textContent = 'Sincronizado';
                    syncButton.onclick = () => markAsSynced(establishment.id);
                    actionsCell.appendChild(syncButton);
                }
                
                // Botão Excluir
                const deleteButton = document.createElement('button');
                deleteButton.className = 'btn-action btn-delete';
                deleteButton.textContent = 'Excluir';
                deleteButton.onclick = () => deleteEstablishment(establishment.id);
                actionsCell.appendChild(deleteButton);
                
                row.appendChild(actionsCell);
                
                tableBody.appendChild(row);
            });
        }
        
        // Função para marcar estabelecimento como sincronizado
        function markAsSynced(id) {
            if (!confirm('Confirma que este estabelecimento foi sincronizado com o BTC Maps?')) {
                return;
            }
            
            // Obter lista de estabelecimentos
            let establishments = JSON.parse(localStorage.getItem('establishments') || '[]');
            
            // Encontrar estabelecimento
            const index = establishments.findIndex(e => e.id === id);
            if (index === -1) return;
            
            // Atualizar status
            establishments[index].status = 'synced';
            establishments[index].sincronizado = true;
            establishments[index].data_sincronizacao = new Date().toISOString();
            
            // Salvar no localStorage
            localStorage.setItem('establishments', JSON.stringify(establishments));
            
            // Registrar no log de auditoria
            logAction('Sincronização', `Estabelecimento "${establishments[index].nome}" marcado como sincronizado com BTC Maps`);
            
            // Recarregar lista
            loadEstablishments();
            
            // Atualizar contadores
            updateCounters();
        }
        
        // Função para editar estabelecimento
        function editEstablishment(id) {
            alert('Funcionalidade de edição será implementada em breve.');
        }
        
        // Função para excluir estabelecimento
        function deleteEstablishment(id) {
            if (!confirm('Tem certeza que deseja excluir este estabelecimento?')) {
                return;
            }
            
            // Obter lista de estabelecimentos
            let establishments = JSON.parse(localStorage.getItem('establishments') || '[]');
            
            // Encontrar estabelecimento
            const index = establishments.findIndex(e => e.id === id);
            if (index === -1) return;
            
            const establishmentName = establishments[index].nome;
            
            // Remover estabelecimento
            establishments.splice(index, 1);
            
            // Salvar no localStorage
            localStorage.setItem('establishments', JSON.stringify(establishments));
            
            // Registrar no log de auditoria
            logAction('Exclusão', `Estabelecimento "${establishmentName}" excluído`);
            
            // Recarregar lista
            loadEstablishments();
            
            // Atualizar contadores
            updateCounters();
        }
        
        // Função para gerar ID único
        function generateId() {
            return 'est_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }
        
        // Função para registrar ação no log de auditoria
        function logAction(tipo, descricao) {
            // Obter log atual
            let auditLog = JSON.parse(localStorage.getItem('auditLog') || '[]');
            
            // Adicionar nova entrada
            auditLog.push({
                data: new Date().toISOString(),
                tipo: tipo,
                descricao: descricao,
                usuario: 'Sistema'
            });
            
            // Limitar tamanho do log (manter últimos 1000 registros)
            if (auditLog.length > 1000) {
                auditLog = auditLog.slice(-1000);
            }
            
            // Salvar no localStorage
            localStorage.setItem('auditLog', JSON.stringify(auditLog));
        }
        
        // Função para atualizar contadores
        function updateCounters() {
            // Esta função será implementada quando criarmos os relatórios e estatísticas
            // Por enquanto, apenas registra que os contadores foram atualizados
            console.log('Contadores atualizados');
        }
    </script>
</body>
</html>
